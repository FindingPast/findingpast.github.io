<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Export Video - Frutiger Aero</title>
  <style>
    body {
      background: linear-gradient(#c2e9fb, #a1c4fd);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 2em;
      color: #003049;
      text-align: center;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 0.5em;
    }

    button {
      background-color: #007f5f;
      color: white;
      border: none;
      padding: 0.75em 1.5em;
      border-radius: 6px;
      font-size: 1em;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #005f43;
    }

    video {
      margin-top: 2em;
      width: 640px;
      max-width: 100%;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>
<body>
  <h1>Export Video</h1>
  <p>This preview will simulate the final export.</p>
  <button id="downloadBtn">Download Final Video</button>
  <video id="videoPreview" controls></video>

  <script type="module">
    import { createFFmpeg, fetchFile } from "https://findingpast.github.io/FFmpeg/ffmpeg-core.js";

    const ffmpeg = createFFmpeg({
      corePath: "https://www.dropbox.com/scl/fi/mghtnmzceuwda4wd1hkkq/ffmpeg-core.wasm?rlkey=5syhn78kcifeef45xtrh1gmt3&st=v7ewhyok&dl=1",
      log: true
    });

    const downloadBtn = document.getElementById('downloadBtn');
    const videoPreview = document.getElementById('videoPreview');

    downloadBtn.addEventListener('click', async () => {
      downloadBtn.disabled = true;
      downloadBtn.textContent = "Processing...";

      if (!ffmpeg.isLoaded()) await ffmpeg.load();

      const image = await fetchFile("assets/sample.jpg"); // adjust if needed
      const audio = await fetchFile("assets/sample.mp3"); // adjust if needed

      ffmpeg.FS('writeFile', 'image.jpg', image);
      ffmpeg.FS('writeFile', 'audio.mp3', audio);

      await ffmpeg.run(
        '-loop', '1',
        '-i', 'image.jpg',
        '-i', 'audio.mp3',
        '-c:v', 'libx264',
        '-c:a', 'aac',
        '-shortest',
        '-t', '5',
        'output.mp4'
      );

      const data = ffmpeg.FS('readFile', 'output.mp4');
      const videoBlob = new Blob([data.buffer], { type: 'video/mp4' });
      const videoURL = URL.createObjectURL(videoBlob);

      videoPreview.src = videoURL;

      const a = document.createElement('a');
      a.href = videoURL;
      a.download = 'exported-video.mp4';
      a.textContent = 'Download Video';
      a.style.display = 'block';
      a.style.marginTop = '1em';
      document.body.appendChild(a);

      downloadBtn.textContent = "Download Final Video";
      downloadBtn.disabled = false;
    });
  </script>
</body>
</html>
