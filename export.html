<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Export Video - Frutiger Aero</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: linear-gradient(to bottom, #cceeff 0%, #99ddff 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    h1 {
      color: #005577;
    }
    button {
      padding: 12px 24px;
      background: #007766;
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
    }
    video {
      margin-top: 2rem;
      width: 480px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <h1>Export Video</h1>
  <p>This preview will simulate the final export.</p>
  <button onclick="startRender()">Download Final Video</button>
  <video id="preview" controls></video>

  <script type="module">
    import { createFFmpeg, fetchFile } from 'https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js';

    const ffmpeg = createFFmpeg({
      log: true,
      corePath: 'https://www.dl.dropboxusercontent.com/scl/fi/mghtnmzceuwda4wd1hkkq/ffmpeg-core.wasm?rlkey=5syhn78kcifeef45xtrh1gmt3&dl=1',
      coreURL: {
        js: 'https://findingpast.github.io/FFmpeg/ffmpeg-core.js',
        wasm: 'https://www.dl.dropboxusercontent.com/scl/fi/mghtnmzceuwda4wd1hkkq/ffmpeg-core.wasm?rlkey=5syhn78kcifeef45xtrh1gmt3&dl=1',
        worker: 'https://findingpast.github.io/FFmpeg/ffmpeg-core.worker.js'
      }
    });

    async function startRender() {
      const preview = document.getElementById('preview');

      await ffmpeg.load();

      // Replace these with actual assets you have:
      const image1 = await fetchFile('assets/img1.jpg');
      const image2 = await fetchFile('assets/img2.jpg');
      const audio = await fetchFile('assets/music.mp3');

      ffmpeg.FS('writeFile', 'img1.jpg', image1);
      ffmpeg.FS('writeFile', 'img2.jpg', image2);
      ffmpeg.FS('writeFile', 'music.mp3', audio);

      await ffmpeg.run(
        '-loop', '1', '-t', '3', '-i', 'img1.jpg',
        '-loop', '1', '-t', '3', '-i', 'img2.jpg',
        '-i', 'music.mp3',
        '-filter_complex', '[0:v][1:v]concat=n=2:v=1:a=0,format=yuv420p[v]',
        '-map', '[v]', '-map', '2:a',
        '-shortest', 'output.mp4'
      );

      const data = ffmpeg.FS('readFile', 'output.mp4');
      const videoBlob = new Blob([data.buffer], { type: 'video/mp4' });
      const url = URL.createObjectURL(videoBlob);

      preview.src = url;

      const dl = document.createElement('a');
      dl.href = url;
      dl.download = 'exported_video.mp4';
      dl.textContent = 'Download Final Video';
      dl.style.marginTop = '1rem';

      const oldButton = document.querySelector('button');
      oldButton.replaceWith(dl);
    }
  </script>
</body>
</html>
