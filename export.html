<!DOCTYPE html>
<html>
<head>
  <title>Export Preview</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #e1f5fe;
      color: #004d40;
    }
    h1 {
      color: #00796b;
    }
    button {
      padding: 10px 20px;
      background-color: #009688;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      margin-top: 10px;
    }
    video {
      width: 100%;
      max-width: 720px;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <h1>Export Video Preview</h1>
  <p>Click the button below to generate a video preview using your images and music.</p>
  <button onclick="generateVideo()">Download Video</button>
  <video id="outputVideo" controls style="display:none;"></video>

  <script type="module">
    import { createFFmpeg, fetchFile } from 'https://unpkg.com/@ffmpeg/ffmpeg@0.12.2/dist/esm/index.js';

    const ffmpeg = createFFmpeg({
      log: true,
      corePath: 'https://drive.google.com/uc?export=download&id=1y4OQNs7g7l-wcUreyJZVa_hnPmZAEwbI'
    });

    const images = [
      "https://raw.githubusercontent.com/FindingPast/frutiger-aero/main/images/Vibes.jpeg",
      "https://raw.githubusercontent.com/FindingPast/frutiger-aero/main/images/Open.jpeg",
      "https://raw.githubusercontent.com/FindingPast/frutiger-aero/main/images/Life.jpeg"
    ];
    const audioUrl = "https://raw.githubusercontent.com/FindingPast/frutiger-aero/main/music/yume%202kki%20-%20lotus%20waters.mp3";

    window.generateVideo = async function () {
      if (!ffmpeg.isLoaded()) await ffmpeg.load();

      const audioData = await fetchFile(audioUrl);
      ffmpeg.FS('writeFile', 'music.mp3', audioData);

      for (let i = 0; i < images.length; i++) {
        const imgData = await fetchFile(images[i]);
        const paddedIndex = String(i + 1).padStart(3, '0');
        ffmpeg.FS('writeFile', `img${paddedIndex}.jpg`, imgData);
      }

      await ffmpeg.run(
        '-framerate', '1/5',
        '-i', 'img%03d.jpg',
        '-i', 'music.mp3',
        '-c:v', 'libx264',
        '-r', '30',
        '-pix_fmt', 'yuv420p',
        '-shortest',
        'output.mp4'
      );

      const data = ffmpeg.FS('readFile', 'output.mp4');
      const video = document.getElementById('outputVideo');
      video.src = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
      video.style.display = 'block';
    };
  </script>
</body>
</html>
